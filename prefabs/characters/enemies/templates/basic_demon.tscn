[gd_scene load_steps=50 format=3 uid="uid://dbi7q70ylhenu"]

[ext_resource type="Script" path="res://prefabs/characters/enemies/enemy.gd" id="1_2pipn"]
[ext_resource type="PackedScene" uid="uid://djecjq7altdel" path="res://prefabs/characters/hit_effect.tscn" id="2_na87u"]
[ext_resource type="Texture2D" uid="uid://doqvahoxybe1n" path="res://assets/images/shadow_clouds.png" id="3_g3ubx"]
[ext_resource type="PackedScene" uid="uid://cd04s5plkgpld" path="res://assets/models/enemies/basic_demon/demon.tscn" id="4_fsrn7"]
[ext_resource type="PackedScene" uid="uid://ds2fy5i2ofqtk" path="res://assets/models/enemies/basic_demon/basic_demon_anim.tscn" id="5_ocgc6"]
[ext_resource type="Material" uid="uid://vhexgxe6hr38" path="res://assets/materials/demon_udim.tres" id="6_7i1dt"]
[ext_resource type="PackedScene" uid="uid://cvpp8sp0ggpql" path="res://prefabs/characters/health_manager.tscn" id="7_5f7io"]
[ext_resource type="PackedScene" uid="uid://cawphrhgamkmm" path="res://prefabs/characters/enemies/behaviors/melee_flank_behavior.tscn" id="8_472c6"]
[ext_resource type="PackedScene" uid="uid://dhdiuw8ths0en" path="res://prefabs/characters/enemies/tools/state_label.tscn" id="9_hurru"]
[ext_resource type="PackedScene" uid="uid://f5co8frc5i74" path="res://prefabs/characters/enemies/attacks/melee_attack_manager.tscn" id="10_m7ecl"]
[ext_resource type="Script" path="res://prefabs/characters/enemies/tools/can_see.gd" id="11_5rq88"]
[ext_resource type="PackedScene" uid="uid://c45k0kryc6nl" path="res://prefabs/characters/character_mover.tscn" id="12_mlgwn"]
[ext_resource type="PackedScene" uid="uid://dlskl61y0hbcv" path="res://prefabs/characters/footsteps.tscn" id="13_vir0a"]
[ext_resource type="AudioStream" uid="uid://dko0jew2i07l" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_FS_1.wav" id="14_2rris"]
[ext_resource type="AudioStream" uid="uid://1ft5kkod7un4" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_FS_2.wav" id="15_mqkqu"]
[ext_resource type="AudioStream" uid="uid://d0dqirkftbibc" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_FS_3.wav" id="16_wxtv6"]
[ext_resource type="AudioStream" uid="uid://b54mef8u2w7ri" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_FS_4.wav" id="17_1vty1"]
[ext_resource type="AudioStream" uid="uid://cp016d40pl4bq" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_FS_5.wav" id="18_pg3in"]
[ext_resource type="AudioStream" uid="uid://bnm0t54pe6org" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_FS_6.wav" id="19_ixmgn"]
[ext_resource type="AudioStream" uid="uid://bly5qtcjq47jc" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_FS_7.wav" id="20_gvpi5"]
[ext_resource type="AudioStream" uid="uid://dsnyegmcnixhw" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_FS_8.wav" id="21_1g6oe"]
[ext_resource type="AudioStream" uid="uid://byeh0aasnsh7p" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_Screech_1.wav" id="22_0fymo"]
[ext_resource type="Script" path="res://scripts/random_audio_stream_player_3d.gd" id="23_l2q3r"]
[ext_resource type="AudioStream" uid="uid://cq3x5348gmuff" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_Screech_2.wav" id="24_rfjl0"]
[ext_resource type="AudioStream" uid="uid://boialt5tn8f02" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_Screech_3.wav" id="25_fqbqt"]
[ext_resource type="AudioStream" uid="uid://ddb3exb4nh8bm" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_Screech_4.wav" id="26_icgb2"]
[ext_resource type="AudioStream" uid="uid://dt50qmmsxca8j" path="res://assets/Audio/SFX/Monster_SFX/Tall_Grunt/A_Tall_Grunt_Screech_5.wav" id="27_nkafu"]
[ext_resource type="AudioStream" uid="uid://ce4x14y08bn1f" path="res://assets/Audio/SFX/Weapon_SFX/Impacts/A_Impact_1.wav" id="28_1g1kb"]
[ext_resource type="AudioStream" uid="uid://6kpk88il4oxd" path="res://assets/Audio/SFX/Weapon_SFX/Impacts/A_Impact_2.wav" id="29_8ym0y"]
[ext_resource type="AudioStream" uid="uid://byj081nptwxua" path="res://assets/Audio/SFX/Weapon_SFX/Impacts/A_Impact_3.wav" id="30_irw1i"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_r0tvl"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_7xuiy"]
shading_mode = 0
albedo_color = Color(0, 0, 0, 1)

[sub_resource type="CapsuleMesh" id="CapsuleMesh_nxllu"]
material = SubResource("StandardMaterial3D_7xuiy")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_opfv5"]
shading_mode = 0
albedo_color = Color(0, 0, 0, 1)

[sub_resource type="BoxMesh" id="BoxMesh_vfnmw"]
material = SubResource("StandardMaterial3D_opfv5")
size = Vector3(0.6, 0.3, 0.3)

[sub_resource type="Curve" id="Curve_0pr0t"]
_data = [Vector2(0.0305343, 0.0170732), 0.0, 0.0, 0, 0, Vector2(0.503817, 0.980976), 0.0, 0.0, 0, 0, Vector2(1, 0.0297561), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="CurveTexture" id="CurveTexture_vo2om"]
curve = SubResource("Curve_0pr0t")

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_xdev0"]
emission_shape = 1
emission_sphere_radius = 1.0
angle_max = 360.0
gravity = Vector3(0, 0, 0)
tangential_accel_min = -8.57
tangential_accel_max = 6.67
scale_max = 4.0
color = Color(0, 0, 0, 1)
alpha_curve = SubResource("CurveTexture_vo2om")

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_x1hw3"]
transparency = 1
vertex_color_use_as_albedo = true
albedo_texture = ExtResource("3_g3ubx")
billboard_mode = 3
billboard_keep_scale = true
particles_anim_h_frames = 1
particles_anim_v_frames = 1
particles_anim_loop = false

[sub_resource type="QuadMesh" id="QuadMesh_16bfa"]
material = SubResource("StandardMaterial3D_x1hw3")

[sub_resource type="Animation" id="Animation_wu4xq"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Demon:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector3(2, 2, 2)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("GPUParticles3D:emitting")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("OmniLight3D:light_energy")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [1.0]
}

[sub_resource type="Animation" id="Animation_d5by4"]
resource_name = "Attack"
length = 1.75
step = 0.01
tracks/0/type = "animation"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BasicDemonAnim/AnimationPlayer")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"clips": PackedStringArray("demon_basic_anim_attack"),
"times": PackedFloat32Array(0.01)
}
tracks/1/type = "method"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../AttackManager")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.5),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"perform_attack"
}]
}
tracks/2/type = "method"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("../ImpactSounds")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0.49),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [0.0],
"method": &"play_random"
}]
}

[sub_resource type="Animation" id="Animation_rhgbu"]
resource_name = "death"
length = 3.75
step = 0.01
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Demon:scale")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 1),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Vector3(2, 2, 2), Vector3(0, 0, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("GPUParticles3D:emitting")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.1),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, false]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("OmniLight3D:light_energy")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0, 1),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [1.0, 0.0]
}
tracks/3/type = "animation"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("BasicDemonAnim/AnimationPlayer")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"clips": PackedStringArray("demon_basic_anim_death"),
"times": PackedFloat32Array(0.01)
}

[sub_resource type="Animation" id="Animation_dorfj"]
resource_name = "idle"
length = 6.7
loop_mode = 1
step = 0.01
tracks/0/type = "animation"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BasicDemonAnim/AnimationPlayer")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"clips": PackedStringArray("demon_basic_anim_idle"),
"times": PackedFloat32Array(0.01)
}

[sub_resource type="Animation" id="Animation_iwb3n"]
resource_name = "walk"
length = 1.41
loop_mode = 1
step = 0.01
tracks/0/type = "animation"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("BasicDemonAnim/AnimationPlayer")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"clips": PackedStringArray("demon_basic_anim_walk"),
"times": PackedFloat32Array(0.02)
}
tracks/1/type = "method"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("../Footsteps")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.37, 1.06),
"transitions": PackedFloat32Array(1, 1),
"values": [{
"args": [],
"method": &"play_step"
}, {
"args": [],
"method": &"play_step"
}]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_yj12p"]
_data = {
"RESET": SubResource("Animation_wu4xq"),
"attack": SubResource("Animation_d5by4"),
"death": SubResource("Animation_rhgbu"),
"idle": SubResource("Animation_dorfj"),
"moving": SubResource("Animation_iwb3n")
}

[sub_resource type="SphereMesh" id="SphereMesh_6pu0l"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_j2qcd"]
albedo_color = Color(1, 0, 0, 1)

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_xvubw"]
albedo_color = Color(0, 0, 1, 1)

[node name="TestEnemy" type="CharacterBody3D"]
collision_layer = 2
collision_mask = 3
script = ExtResource("1_2pipn")
hit_effect_prefab = ExtResource("2_na87u")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
shape = SubResource("CapsuleShape3D_r0tvl")

[node name="Graphics" type="Node3D" parent="."]

[node name="OmniLight3D" type="OmniLight3D" parent="Graphics"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
light_negative = true
omni_range = 10.0
omni_attenuation = 3.03143

[node name="MeshInstance3D" type="MeshInstance3D" parent="Graphics"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
visible = false
mesh = SubResource("CapsuleMesh_nxllu")

[node name="MeshInstance3D2" type="MeshInstance3D" parent="Graphics"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.5, -0.5)
visible = false
mesh = SubResource("BoxMesh_vfnmw")

[node name="GPUParticles3D" type="GPUParticles3D" parent="Graphics"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
amount = 16
lifetime = 2.08
explosiveness = 0.09
randomness = 0.45
process_material = SubResource("ParticleProcessMaterial_xdev0")
draw_pass_1 = SubResource("QuadMesh_16bfa")

[node name="GPUParticlesAttractorSphere3D" type="GPUParticlesAttractorSphere3D" parent="Graphics"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
strength = 17.65
attenuation = 12.5534
cull_mask = 4293918721
radius = 4.0

[node name="AnimationPlayer" type="AnimationPlayer" parent="Graphics"]
libraries = {
"": SubResource("AnimationLibrary_yj12p")
}
autoplay = "idle"

[node name="Demon" parent="Graphics" instance=ExtResource("4_fsrn7")]
transform = Transform3D(2, 0, 0, 0, 2, 0, 0, 0, 2, 0, -0.1, 0)
visible = false

[node name="HitPoint" type="Node3D" parent="Graphics"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)

[node name="BasicDemonAnim" parent="Graphics" instance=ExtResource("5_ocgc6")]

[node name="Skeleton3D" parent="Graphics/BasicDemonAnim/RootNode/demon" index="0"]
bones/0/rotation = Quaternion(0.0036388, 0.00295594, -0.00787137, 0.999958)
bones/2/rotation = Quaternion(0.171836, -0.00579038, 0.010269, 0.985055)
bones/3/rotation = Quaternion(0.107118, -0.00627513, 0.00961875, 0.99418)
bones/4/rotation = Quaternion(0.0709668, 0.00571361, -0.0104779, 0.997407)
bones/5/rotation = Quaternion(-0.191858, 0.030475, -0.016626, 0.980809)
bones/7/rotation = Quaternion(0.67532, 0.471651, -0.358988, 0.438881)
bones/8/rotation = Quaternion(0.197292, -0.22346, 0.226227, 0.927342)
bones/9/rotation = Quaternion(0.202177, 0.0614683, 0.41557, 0.884674)
bones/10/rotation = Quaternion(0.0989257, -0.579602, 0.187124, 0.786931)
bones/11/rotation = Quaternion(0.184263, 0.968879, 0.132494, 0.0988193)
bones/12/rotation = Quaternion(0.307388, 0.0721742, 0.217766, 0.923516)
bones/13/rotation = Quaternion(-0.167503, -0.182787, -0.100748, 0.963525)
bones/15/rotation = Quaternion(0.66259, -0.471984, 0.385956, 0.435021)
bones/16/rotation = Quaternion(0.265234, 0.199796, -0.137536, 0.933176)
bones/17/rotation = Quaternion(0.209175, 0.094875, -0.548133, 0.804236)
bones/18/rotation = Quaternion(0.119507, 0.119744, 0.0031079, 0.985581)
bones/19/rotation = Quaternion(0.327453, -0.431626, -0.0108834, 0.840449)
bones/20/rotation = Quaternion(0.0513406, 0.0483853, -0.225414, 0.971705)
bones/23/rotation = Quaternion(0.0840785, 0.297877, 0.931737, -0.189913)
bones/24/rotation = Quaternion(-0.459678, 0.00636692, -0.0737565, 0.884995)
bones/25/rotation = Quaternion(0.596176, -0.0661481, -0.0192222, 0.799893)
bones/26/rotation = Quaternion(0.317946, -0.0367414, -0.096464, 0.942473)
bones/28/rotation = Quaternion(-0.151008, 0.30641, 0.929408, 0.139679)
bones/29/rotation = Quaternion(-0.459852, -0.0379586, -0.00523361, 0.887168)
bones/30/rotation = Quaternion(0.578782, 0.116801, 0.0311729, 0.806472)
bones/31/rotation = Quaternion(0.308081, 0.132491, 0.105016, 0.936218)

[node name="demon1" parent="Graphics/BasicDemonAnim/RootNode/demon/Skeleton3D" index="0"]
material_override = ExtResource("6_7i1dt")

[node name="HealthManager" parent="." instance=ExtResource("7_5f7io")]
max_health = 20

[node name="MeleeFlankBehavior" parent="." node_paths=PackedStringArray("melee_attack_manager", "character_mover") instance=ExtResource("8_472c6")]
melee_attack_manager = NodePath("../AttackManager")
character_mover = NodePath("../CharacterMover")

[node name="StateLabel" parent="." instance=ExtResource("9_hurru")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.3, 0)
visible = false

[node name="AttackManager" parent="." instance=ExtResource("10_m7ecl")]
damage_dealt = 10
attack_cooldown = 1.5

[node name="CanSee" type="MeshInstance3D" parent="." node_paths=PackedStringArray("behavior")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 3, 0)
visible = false
mesh = SubResource("SphereMesh_6pu0l")
script = ExtResource("11_5rq88")
behavior = NodePath("../MeleeFlankBehavior")
seen_material = SubResource("StandardMaterial3D_j2qcd")
unseen_material = SubResource("StandardMaterial3D_xvubw")

[node name="CharacterMover" parent="." instance=ExtResource("12_mlgwn")]
gravity = 80.0
default_max_speed = 5.0
move_accel = 2.0

[node name="Footsteps" parent="." instance=ExtResource("13_vir0a")]
volume_db = -3.023
footstep_streams = Array[AudioStream]([ExtResource("14_2rris"), ExtResource("15_mqkqu"), ExtResource("16_wxtv6"), ExtResource("17_1vty1"), ExtResource("18_pg3in"), ExtResource("19_ixmgn"), ExtResource("20_gvpi5"), ExtResource("21_1g6oe")])

[node name="Screech" type="AudioStreamPlayer3D" parent="."]
stream = ExtResource("22_0fymo")
volume_db = -12.19
bus = &"Reverb"
attenuation_filter_cutoff_hz = 7500.0
attenuation_filter_db = -19.0
script = ExtResource("23_l2q3r")
streams = Array[AudioStream]([ExtResource("22_0fymo"), ExtResource("24_rfjl0"), ExtResource("25_fqbqt"), ExtResource("26_icgb2"), ExtResource("27_nkafu")])

[node name="ImpactSounds" type="AudioStreamPlayer3D" parent="."]
volume_db = -19.571
bus = &"Sfx"
script = ExtResource("23_l2q3r")
streams = Array[AudioStream]([ExtResource("28_1g1kb"), ExtResource("29_8ym0y"), ExtResource("30_irw1i")])

[node name="DespawnTimer" type="Timer" parent="."]
wait_time = 4.0
one_shot = true

[connection signal="state_changed" from="MeleeFlankBehavior" to="." method="_on_melee_flank_behavior_state_changed"]
[connection signal="state_changed" from="MeleeFlankBehavior" to="StateLabel" method="_on_state_changed"]
[connection signal="start_attack" from="AttackManager" to="Graphics/AnimationPlayer" method="play" binds= ["attack"]]
[connection signal="timeout" from="DespawnTimer" to="." method="queue_free"]

[editable path="Graphics/BasicDemonAnim"]
